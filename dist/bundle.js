// Generated by luminjs bundle
(function(){

function signal(initialValue) {
  let value = initialValue;
  const subscribers = new Set();

  function readWrite(next) {
    if (arguments.length === 0) {
      return value;
    } else {
      value = next;
      subscribers.forEach(fn => fn(value));
      return value;
    }
  }

  Object.defineProperty(readWrite, "value", {
    get() {
      return value;
    },
  });

  readWrite._subscribe = (fn) => {
    subscribers.add(fn);
    return () => subscribers.delete(fn);
  };

  return readWrite;
}


const __luminComponents = {};
__luminComponents["App"] = (function() {
function renderToString() {
  return `<div>
  <div data-lumin-mount="Counter"></div>
  <div data-lumin-mount="Counter"></div>
</div>`;
}

const __luminHandlers = {
};

const __luminSignals = {
};

function hydrate(root) {
  root.innerHTML = renderToString();
  const all = root.querySelectorAll('*');
  all.forEach((el) => {
    for (const attr of el.attributes) {
      if (!attr.name.startsWith('data-lumin-on-')) continue;
      const eventName = attr.name.slice('data-lumin-on-'.length);
      const handlerId = attr.value;
      const handler = __luminHandlers[handlerId];
      if (typeof handler === 'function') {
        el.addEventListener(eventName, handler);
      }
    }
  });
  const textTargets = root.querySelectorAll('[data-lumin-text]');
  textTargets.forEach((el) => {
    const name = el.getAttribute('data-lumin-text');
    const sig = __luminSignals[name];
    if (typeof sig === 'function') {
      el.textContent = String(sig());
      if (typeof sig._subscribe === 'function') {
        sig._subscribe((value) => {
          el.textContent = String(value);
        });
      }
    }
  });
  const mounts = root.querySelectorAll('[data-lumin-mount]');
  mounts.forEach((el) => {
    const compName = el.getAttribute('data-lumin-mount');
    const comp = __luminComponents[compName];
    if (comp && typeof comp.hydrate === 'function') {
      comp.hydrate(el);
    }
  });
}

return { renderToString, hydrate };
})();

__luminComponents["Counter"] = (function() {

const count = signal(0)

function inc() {
  count(count() + 1)
}
function dec() {
  count(count() - 1)
}


function renderToString() {
  return `<div>
  <h1>Count: <span data-lumin-text="count"></span></h1>
  <button data-lumin-on-click="inc">Increment</button>
  <button data-lumin-on-click="h0">Decrement</button>
  <button data-lumin-on-click="h1">Log</button>
</div>`;
}

const __luminHandlers = {
  inc: inc,
  h0: () => { count(count() - 1) },
  h1: () => { console.log("Logging to console") },
};

const __luminSignals = {
  count: count,
};

function hydrate(root) {
  root.innerHTML = renderToString();
  const all = root.querySelectorAll('*');
  all.forEach((el) => {
    for (const attr of el.attributes) {
      if (!attr.name.startsWith('data-lumin-on-')) continue;
      const eventName = attr.name.slice('data-lumin-on-'.length);
      const handlerId = attr.value;
      const handler = __luminHandlers[handlerId];
      if (typeof handler === 'function') {
        el.addEventListener(eventName, handler);
      }
    }
  });
  const textTargets = root.querySelectorAll('[data-lumin-text]');
  textTargets.forEach((el) => {
    const name = el.getAttribute('data-lumin-text');
    const sig = __luminSignals[name];
    if (typeof sig === 'function') {
      el.textContent = String(sig());
      if (typeof sig._subscribe === 'function') {
        sig._subscribe((value) => {
          el.textContent = String(value);
        });
      }
    }
  });
  const mounts = root.querySelectorAll('[data-lumin-mount]');
  mounts.forEach((el) => {
    const compName = el.getAttribute('data-lumin-mount');
    const comp = __luminComponents[compName];
    if (comp && typeof comp.hydrate === 'function') {
      comp.hydrate(el);
    }
  });
}

return { renderToString, hydrate };
})();


window.Lumin = { components: __luminComponents, hydrate: (root) => __luminComponents["App"].hydrate(root) };
})();
